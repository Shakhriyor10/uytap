{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Главная — Мой Airbnb</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <style>
    body { background-color: #fdf6f0; } /* молочный фон */
    .listing-card {
      border-radius:15px;
      overflow:hidden;
      transition:0.3s;
      background:#fff;
    }
    .listing-card:hover {
      transform: scale(1.03);
      box-shadow:0 8px 20px rgba(0,0,0,0.15);
    }
    .listing-img { height:200px; object-fit:cover; width:100%; border-bottom:1px solid #eee; }
    .listing-body { padding:15px; }
    .listing-title { font-size:1.2rem; font-weight:600; margin-bottom:5px; }
    .listing-city { color:#555; font-size:0.95rem; margin-bottom:5px; }
    .listing-price { font-weight:700; font-size:1.1rem; margin-bottom:5px; color:#e63946; }
    .listing-rating { color:#f4c150; font-size:0.9rem; margin-bottom:10px; }
    .swiper { width:100%; height:200px; }
    .swiper-slide img { width:100%; height:200px; object-fit:cover; }

    /* Кнопки */
    .btn-custom {
      background: linear-gradient(90deg, #ff7e5f, #feb47b);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight:600;
      transition: 0.3s;
    }
    .btn-custom:hover {
      background: linear-gradient(90deg, #feb47b, #ff7e5f);
      color:#fff;
      transform: translateY(-2px);
      box-shadow:0 5px 15px rgba(0,0,0,0.2);
    }
    .btn-custom:focus { box-shadow:none; }
  </style>
</head>
<body>

<div class="container py-5">
  <h1 class="mb-4 text-center">Список квартир</h1>

  <!-- Фильтры -->
  <form method="get" class="row mb-4 g-2">
    <div class="col-md-4">
      <select name="city" class="form-select">
        <option value="">Все города</option>
        {% for c in cities %}
          <option value="{{ c }}" {% if c == selected_city %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <select name="property_type" class="form-select">
        <option value="">Все типы</option>
        {% for key,label in property_types %}
          <option value="{{ key }}" {% if key == selected_type %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <button type="submit" class="btn btn-custom w-100">Фильтровать</button>
    </div>
  </form>

  <!-- Список квартир -->
  <div class="row g-4">
    {% for listing in listings %}
    <div class="col-md-4">
      <div class="card listing-card shadow-sm">
        <!-- Слайдер изображений -->
        <div class="swiper mySwiper">
          <div class="swiper-wrapper">
            {% for img in listing.images.all %}
            <div class="swiper-slide">
              <img src="{{ img.image.url }}" alt="{{ listing.title }}">
            </div>
            {% empty %}
            <div class="swiper-slide">
              <img src="{% static 'placeholder.png' %}" alt="Нет фото">
            </div>
            {% endfor %}
          </div>
          <div class="swiper-pagination"></div>
        </div>

        <div class="listing-body">
          <div class="listing-title">{{ listing.title }}</div>
          <div class="listing-city">{{ listing.city }}</div>
          <div class="listing-price">{{ listing.price_per_day }} $/день</div>
          <div class="listing-rating">
            {% for i in "12345"|slice:":listing.rating"|make_list %}
              ★
            {% endfor %}
          </div>
          <a href="#" class="btn btn-custom w-100">Посмотреть</a>
        </div>
      </div>
    </div>
    {% empty %}
      <p>Объявлений пока нет.</p>
    {% endfor %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<script>
  const swipers = document.querySelectorAll('.mySwiper');
  swipers.forEach((el) => {
    new Swiper(el, {
      loop:true,
      pagination: {
        el: el.querySelector('.swiper-pagination'),
        clickable: true,
      },
    });
  });
</script>
</body>
</html>
